<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>印彩云欢迎您 </title>
  <link href="../yincai/Content/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="../yincai/Content/vendors/font-awesome/css/font-awesome.css" rel="stylesheet" />
  <link href="../yincai/Content/iconfont/iconfont.css" rel="stylesheet" />
  <link href="../yincai/Content/css/base.css" rel="stylesheet" />
  <link href="../yincai/Content/css/site.css" rel="stylesheet" />
  <link href="../yincai/Content/css/shop/common.css" rel="stylesheet" />
  <link href="../yincai/Content/css/page/footerserver.css" rel="stylesheet" />
  <link href="../yincai/Content/css/shop/cart.css" rel="stylesheet" />
  <link href="../yincai/Content/css/shop/cart_item.css" rel="stylesheet" />
</head>

<body>

  <div class="wrapper">
    <div class="w clearfix">
      <div class="content-wrap">
        <div class="cart-nav clearfix">
          <h3>
            <i class="icon cart_icon"></i> 购物车 <span class="count">2/20</span>
          </h3>
          <div class="process">
            <ul class="clearfix">
              <li class="step step-now">
                <div class="num num-a">1.提交订单</div>
                <div class="arrow arrow-a icon"></div>
              </li>
              <li class="step ">
                <div class="num num-b ">2.确认并支付</div>
                <div class="arrow arrow-b icon"></div>
              </li>
              <li class="step ">
                <div class="num num-c">3.购买成功</div>
                <div class="arrow arrow-c icon"></div>
              </li>
            </ul>
          </div>
        </div>

        <div class="cart-wrap">
          <div class="cart-list">
            <ul class="cart-title clearfix">
              <li class="title-item pic-item">商品图片</li>
              <li class="title-item name-item">名称/件数</li>
              <li class="title-item operation">操作</li>
            </ul>
            <div class="cart-item-list">
              <ul class="cart-item clearfix">
                <li class="item item-checkbox">

                  <input data-id="25945" class="cart-item-checkbox" type="checkbox" name="cart">

                </li>
                <li class="item item-pic">
                  <a href="/details?styleId=191259" target="_blank"><img
                      src="https://www.dingzhilian.com/upload_dz/style/191009144435818324.jpg"></a>

                </li>
                <li class="item pro-info">
                  <p class="name-top clearfix">
                    <span class="cart-item-words">JSH666CVC280g毛圈套头卫衣</span>
                    <span class="cart-item-style">男女同款/黑色</span>
                    <span class="cart-item-totle">共<span class="cart-item-num">1</span>件，￥<span
                        class="cart-item-price">29</span></span>
                  </p>
                  <ul class="size-lists clearfix">
                    <li class="size-title">
                      <p class="size-title-item">尺码 </p>
                      <p class="size-title-item">库存</p>
                      <p class="size-title-item">价格</p>
                      <p class="size-title-item">采购数量</p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">3XL</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25945" data-productId="244222" class="cart-item-input"
                          type="text" value="0" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">XL</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25945" data-productId="244222" class="cart-item-input"
                          type="text" value="0" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">M</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25945" data-productId="244222" class="cart-item-input"
                          type="text" value="0" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">XXL</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25945" data-productId="244222" class="cart-item-input"
                          type="text" value="0" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">L</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25945" data-productId="244222" class="cart-item-input"
                          type="text" value="0" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">S</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25945" data-productId="244222" class="cart-item-input"
                          type="text" value="1" maxlength="5"></p>
                    </li>
                    <li class="size-item">
                      <p class="size-name">S</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25945" data-productId="244222" class="cart-item-input"
                          type="text" value="1" maxlength="5"></p>
                    </li>
                    <li class="size-item">
                      <p class="size-name">S</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25945" data-productId="244222" class="cart-item-input"
                          type="text" value="1" maxlength="5"></p>
                    </li>
                    <li class="size-item">
                      <p class="size-name">S</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25945" data-productId="244222" class="cart-item-input"
                          type="text" value="1" maxlength="5"></p>
                    </li>
                  </ul>
                </li>
                <li class="item cart-item-del" data-id="25945">删除</li>
              </ul>

              <ul class="cart-item clearfix">
                <li class="item item-checkbox">

                  <input data-id="25944" class="cart-item-checkbox" type="checkbox" name="cart">

                </li>
                <li class="item item-pic">
                  <a href="/details?styleId=191259" target="_blank"><img
                      src="https://www.dingzhilian.com/upload_dz/style/191009144435818324.jpg"></a>

                </li>
                <li class="item pro-info">
                  <p class="name-top clearfix">
                    <span class="cart-item-words">JSH666CVC280g毛圈套头卫衣</span>
                    <span class="cart-item-style">男女同款/白色</span>
                    <span class="cart-item-totle">共<span class="cart-item-num">5</span>件，￥<span
                        class="cart-item-price">145</span></span>
                  </p>
                  <ul class="size-lists clearfix">
                    <li class="size-title">
                      <p class="size-title-item">尺码 </p>
                      <p class="size-title-item">库存</p>
                      <p class="size-title-item">价格</p>
                      <p class="size-title-item">采购数量</p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">S</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25944" data-productId="244221" class="cart-item-input"
                          type="text" value="0" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">3XL</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25944" data-productId="244221" class="cart-item-input"
                          type="text" value="0" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">XL</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25944" data-productId="244221" class="cart-item-input"
                          type="text" value="0" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">M</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25944" data-productId="244221" class="cart-item-input"
                          type="text" value="2" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">XXL</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25944" data-productId="244221" class="cart-item-input"
                          type="text" value="0" maxlength="5"></p>
                    </li>

                    <li class="size-item">
                      <p class="size-name">L</p>
                      <p class="stock">0</p>
                      <p class="s-price">29</p>
                      <p class="purchase"><input data-id="25944" data-productId="244221" class="cart-item-input"
                          type="text" value="3" maxlength="5"></p>
                    </li>

                  </ul>
                </li>
                <li class="item cart-item-del" data-id="25944">删除</li>
              </ul>
            </div>
          </div>

          <div class="cart-btm clearfix">
            <div class="left fl">
              <input type="checkbox" name="checkall" id="checkall">
              <span class="checkall">全选</span>
              <span class="del-checked">删除选中的商品</span>
            </div>
            <div class="fr cleafix">
              <div class="all-total">
                <p class="all-num">共<span id="all-num">0</span>件，¥<span id="all-price">0</span></p>
                <p class="freight">不含运费</p>
              </div>
              <a href="javascript:void(0)" onclick="confirm()" class="settlement">去结算</a>
            </div>
          </div>

        </div>
        <!--判断购物车是否为空-->
        <div class="cart-empty">
          <div class="cart-empty-tips cf">
            <i class="cart-empty-icon"></i>
            <h4>您的购物车还是空的，赶紧行动吧！您可以：</h4>
            <ul>
              <!-- <li><a class="u-basecolor" href="/account/login">登录</a>后，将显示您之前加入购物车的商品</li> -->
              <li>去<a class="u-basecolor" href="/">首页</a>购买喜欢的产品</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../yincai/Scripts/jquery-1.10.2.js"></script>
  <script src="../yincai/Scripts/bootstrap.min.js"></script>
  <script src="../yincai/Content/js/jquery_lazyload-1.9.3/jquery.lazyload.min.js"></script>
  <!-- <script src="../yincai/Scripts/jquery.msgBox.js"></script>
  <script src="../yincai/Scripts/jquery.msgProcess.js"></script> -->
  <script src="../yincai/Content/js/code/com.js"></script>
  <script src="../yincai/Content/js/shop/common.js"></script>
  <script src='../vendors/zoom-master/jquery.zoom.js'></script>

  <script>
    $(function () {
      $('.cart-empty').hide();

      $('.cart-item-list').on('keyup', '.cart-item-input', function () {
        if ($(this).val()) {
          $(this).val($(this).val().replace(/[^\d]/g, 0));
        }
      });
      $('#checkall').prop('checked', '');

      //商品选中
      $('.cart-item-list').on('change', '.cart-item-checkbox', function () {
        var cartLen = $('.cart-item').length;
        var itemLen = $('.cart-item-checkbox:checked').length;
        if (itemLen == cartLen) {
          $('#checkall').prop('checked', 'checked')
        } else {
          $('#checkall').prop('checked', '')
        }

        calculCartTatol();
      });

      //全选
      $('#checkall').change(function () {
        var checkall = $(this).prop('checked');
        if (checkall) {
          $('.cart-item-checkbox').prop('checked', 'checked');
        } else {
          $('.cart-item-checkbox').prop('checked', '');
        }

        calculCartTatol();
      });


      //采购数量编辑
      var skuList = [];
      var cartItemNum = 0;
      $('.cart-item-list').on('change', '.cart-item-input', function () {
        skuList = [];
        cartItemNum = 0;
        var cartItem = $(this).parents('.cart-item');
        var index = $(this).parents('.size-item').index() - 1;
        for (var i = 0; i < cartItem.find('.size-item').length; i++) {
          var size = cartItem.find('.size-item:eq(' + i + ')').find('.size-name').text();
          var price = cartItem.find('.size-item:eq(' + i + ') .s-price').text();
          var count = parseInt(cartItem.find('.size-item:eq(' + i + ') .cart-item-input').val());
          cartItemNum += count;
          if (count > 0) {
            skuList.push({ 'Size': size, 'Price': price, 'Count': count });
          };
        }

        if (cartItemNum == 0) {
          $(this).val(1);
          skuList[index].count = 1;
        }

        var productId = $(this).attr('data-productId');
        var cartId = $(this).attr('data-id');

        alert("productId-" + productId + ",cartId-" + cartId + ",skuList-" + JSON.stringify(skuList));
        //updataCart(this,detailId,cartId,JSON.stringify(skuList));
      });
    });

    // 计算数量和总钱
    function calculCartTatol() {
      totalNum = 0;
      totalPrice = 0;
      $('.cart-item-checkbox').each(function () {
        if ($(this).prop('checked')) {
          var cartItem = $(this).parents('.cart-item');
          var cartId = $(this).attr('data-id')
          var thisNum = parseFloat(cartItem.find('.cart-item-num').text());
          var thisPrice = parseFloat(cartItem.find('.cart-item-price').text());
          totalNum += thisNum;
          totalPrice += thisPrice;
        }
      });
      $('#all-num').text(totalNum);
      $('#all-price').text(totalPrice.toFixed(2));
    }

    //单个产品删除
    $('.cart-item-list').on('click', '.cart-item-del', function () {
      $(this).parents('.cart-item').remove();
      cartEmpty();
      var id = $(this).attr('data-id');

      doCartDel(id);
    });

    //多个产品删除
    $('.del-checked').click(function () {
      var catIds = [];
      $('.cart-item-checkbox').each(function () {
        if ($(this).prop('checked')) {
          catIds.push($(this).attr('data-id'));
          $(this).parents('.cart-item').remove();
        }
      });

      if (catIds.length == 0) {
        alert('请选择要删除的商品')
        return;
      }

      doCartDel(catIds.join(','));

    });


    function doCartDel(cartids) {
      alert("删除成功-" + cartids);
      // 删除失败，local.reload()
      calculCartTatol();
      cartEmpty();
    }

    //购物车修改
    function doUpdataCart(obj, productId, cartId, skuJsonList) {
      $.ajax({
        url: '/web/cart/updateCart',
        type: 'POST',
        data: { 'ProductId': productId, 'CartId': cartId, 'SkuJsonList': skuJsonList },
        dataType: 'json'
      }).done(function (json) {
        if (json.code == '200') {
          showmsg('更改完成', 800)
          $(obj).parents('.cart-item').find('.cart-item-num').text(json.dataObject.total)
          $(obj).parents('.cart-item').find('.cart-item-price').text(json.dataObject.total_price.toFixed(2));

          calculCartTatol();
        } else {
          showmsg(json.msg)
        }
      }).fail(function (json) {
        showmsg(json.msg)
      })
    }

    //提交购物车
    function confirm() {
      var cartIds = [];
      $('.cart-item-checkbox').each(function () {
        if ($(this).prop('checked')) {
          cartIds.push($(this).attr('data-id'))
        }
      });

      if (cartIds.length > 0) {
        alert(cartIds.join(','));
      } else {
        alert('请选择商品');
      }
    }

    //购物车为空
    function cartEmpty() {
      var length = $('.cart-item').length;
      if (length == 0) {
        $('.cart-wrap').hide();
        $('.cart-empty').show();
      } else {
        $('.cart-wrap').show();
        $('.cart-empty').hide();
      }
    }

  </script>

</body>


</html>